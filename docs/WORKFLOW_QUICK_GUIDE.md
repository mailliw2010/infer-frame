# 多工作流配置快速使用指南

## 📋 功能概述

AI推理引擎软件 V1.0 现在支持配置和管理多个工作流，您可以：
- ✅ 创建多个独立的推理工作流
- ✅ 快速切换不同的工作流配置
- ✅ 展开/收缩查看工作流详情
- ✅ 激活指定工作流用于实际推理
- ✅ 批量导出/导入工作流配置

## 🚀 快速开始

### 1. 查看工作流列表

登录系统后，点击左侧菜单 **"🔁 工作流配置"**，即可看到：

```
┌─────────────────────────────────────────┐
│  🔁 工作流配置列表                       │
│  [➕ 新建工作流] [📤 导出全部] [📥 导入配置] │
└─────────────────────────────────────────┘

┌─ 默认检测工作流 ──────────────────┐
│  ▶ 默认检测工作流    ✅ 已激活      │
│     [✅ 激活] [✏️ 编辑] [🗑️ 删除]   │
└─────────────────────────────────┘
```

### 2. 展开查看工作流详情

点击工作流名称区域，即可展开查看：

```
┌─ 默认检测工作流 ──────────────────┐
│  ▼ 默认检测工作流    ✅ 已激活      │
│     [✅ 激活] [✏️ 编辑] [🗑️ 删除]   │
│                                    │
│  ┌── 工作流概要 ────────────────┐  │
│  │ 📋 工作流名称                  │  │
│  │ 🧩 部署平台: Ascend           │  │
│  │ 🧠 模型配置                    │  │
│  │ 🔁 业务流                      │  │
│  └────────────────────────────┘  │
│                                    │
│  ┌── 推理流程 ──────────────────┐  │
│  │ 视频流输入 → 模型推理 → 结果输出│  │
│  └────────────────────────────┘  │
│                                    │
│  ┌── 配置详情 ──────────────────┐  │
│  │ 平台: ascend                   │  │
│  │ 模型: yolov8s_quant_310b.om   │  │
│  │ 置信度: 0.6                    │  │
│  │ ...                            │  │
│  └────────────────────────────┘  │
└─────────────────────────────────┘
```

## 📝 常用操作

### 新建工作流

1. 点击 **"➕ 新建工作流"** 按钮
2. 系统自动创建一个基于默认模板的新工作流
3. 新工作流自动展开，可以立即编辑

```javascript
// 系统会自动生成：
{
  id: 'wf_1234567890_xxx',
  name: '新工作流 1',
  active: false,
  config: { /* 默认配置 */ }
}
```

### 编辑工作流

1. 找到要编辑的工作流
2. 点击 **"✏️ 编辑"** 按钮
3. 在弹出的模态框中修改配置：
   - **工作流信息**：修改工作流名称
   - **平台配置**：选择部署平台（Ascend/Sophon/Jetson/CPU）
   - **算法参数**：模型名称、置信度、NMS 阈值、标签映射等
   - **应用配置**：输入源、输出路径、推理频率等
4. 点击 **"保存配置"** 保存更改

**验证规则：**
- 工作流名称不能为空
- 置信度：0-1 之间
- NMS 阈值：0-1 之间
- 推理频率：1-120 fps

### 激活工作流

只有激活的工作流才会在摘要区显示，用于实际推理。

**操作步骤：**
1. 点击要激活的工作流的 **"✅ 激活"** 按钮
2. 之前激活的工作流自动变为未激活状态
3. 顶部摘要区更新为新激活的工作流信息

**提示：**
- 同一时间只能有一个激活的工作流
- 激活的工作流会显示 **"✅ 已激活"** 标签

### 删除工作流

1. 点击要删除的工作流的 **"🗑️ 删除"** 按钮
2. 确认删除提示
3. 工作流被删除

**注意事项：**
- 如果删除的是当前激活的工作流，系统会自动激活第一个工作流
- 至少保留一个工作流

### 导出工作流配置

#### 导出全部工作流

1. 点击 **"📤 导出全部"** 按钮
2. 自动下载 JSON 文件：`workflows_config_2024-XX-XX.json`

**文件格式：**
```json
[
  {
    "id": "wf_1234567890_1",
    "name": "默认检测工作流",
    "active": true,
    "config": { ... }
  },
  {
    "id": "wf_1234567891_2",
    "name": "OCR识别工作流",
    "active": false,
    "config": { ... }
  }
]
```

#### 导出单个工作流（菜单按钮）

1. 点击右上角菜单的 **"📤 导出配置"**
2. 导出当前激活的工作流配置

### 导入工作流配置

1. 点击 **"📥 导入配置"** 按钮
2. 选择 JSON 配置文件
3. 系统自动识别格式并导入：
   - **多工作流格式**：直接替换所有工作流
   - **单工作流格式**：作为新工作流添加到列表

**支持格式：**

多工作流格式（推荐）：
```json
[
  { "id": "...", "name": "...", "active": true, "config": {...} },
  { "id": "...", "name": "...", "active": false, "config": {...} }
]
```

单工作流格式（兼容旧版）：
```json
{
  "platform": {...},
  "algo": {...},
  "app": {...}
}
```

## 🎨 界面说明

### 工作流列表

```
┌─────────────────────────────────────────┐
│  🔁 工作流配置列表                       │
│  [➕ 新建工作流] [📤 导出全部] [📥 导入配置] │
└─────────────────────────────────────────┘

┌─ 工作流1 ─────────────────────────┐
│  ▶ 默认检测工作流    ✅ 已激活      │  ← 点击展开/收缩
│     [✅ 激活] [✏️ 编辑] [🗑️ 删除]   │  ← 操作按钮
└─────────────────────────────────┘

┌─ 工作流2 ─────────────────────────┐
│  ▶ OCR识别工作流     ⏸️ 未激活     │
│     [✅ 激活] [✏️ 编辑] [🗑️ 删除]   │
└─────────────────────────────────┘
```

### 工作流概要（展开状态）

每个工作流展开后显示 4 个概要卡片：

```
┌────────────┬────────────┬────────────┬────────────┐
│ 📋 工作流   │ 🧩 部署平台  │ 🧠 模型配置  │ 🔁 业务流   │
│ 名称       │ Ascend     │ yolov8s    │ 输入→输出   │
│            │ 支持: ...   │ 置信度/NMS │ 类型·频率   │
└────────────┴────────────┴────────────┴────────────┘
```

### 推理流程图

```
┌────────────┐   ┌────────────┐   ┌────────────┐
│ 📹 视频流   │ → │ 🧠 模型推理  │ → │ 📊 结果输出  │
│ 输入       │   │ 检测       │   │ 可视化      │
└────────────┘   └────────────┘   └────────────┘
```

### 配置详情

分为三个部分：
- **平台配置**：运行平台、支持平台
- **算法参数**：模型名称、置信度、NMS、标签映射等
- **应用配置**：输入源、输出路径、推理频率等

## 💡 最佳实践

### 1. 工作流命名建议

建议使用描述性名称，便于识别：

```
✅ 好的命名：
- "人员检测-高精度-Ascend"
- "车辆识别-实时-Jetson"
- "OCR识别-标准配置"

❌ 不好的命名：
- "工作流1"
- "测试"
- "new workflow"
```

### 2. 工作流组织

根据业务场景创建不同工作流：

```
📁 按场景分类：
  ├─ 人员检测工作流
  ├─ 车辆识别工作流
  ├─ OCR识别工作流
  └─ 多目标追踪工作流

📁 按平台分类：
  ├─ Ascend-高性能配置
  ├─ Jetson-边缘部署配置
  └─ CPU-调试配置

📁 按精度分类：
  ├─ 高精度模式（置信度 0.8）
  ├─ 标准模式（置信度 0.6）
  └─ 快速模式（置信度 0.4）
```

### 3. 配置备份

定期导出工作流配置：

```bash
# 建议每周导出一次
workflows_config_2024-01-01.json  # 周一备份
workflows_config_2024-01-08.json  # 下周备份
...

# 或按版本管理
workflows_config_v1.0.json
workflows_config_v1.1.json
```

### 4. 配置复用

需要创建相似配置时：

1. 导出现有工作流
2. 手动编辑 JSON 文件：
   - 修改 `id`（确保唯一性）
   - 修改 `name`
   - 修改需要调整的参数
3. 导入修改后的配置

## 🔧 故障排查

### 问题：导入配置失败

**原因：**
- JSON 格式错误
- 缺少必需字段
- 数据类型不匹配

**解决方案：**
1. 使用 JSON 格式验证工具检查文件
2. 确保包含必需字段：`id`, `name`, `config`
3. 确保 `config` 包含：`platform`, `algo`, `app`

### 问题：无法激活工作流

**原因：**
- 工作流不存在
- ID 不正确

**解决方案：**
1. 刷新页面重新加载
2. 检查浏览器控制台错误信息
3. 清除 localStorage 重新初始化

### 问题：工作流展开后内容为空

**原因：**
- 配置数据丢失
- 渲染函数错误

**解决方案：**
1. 检查工作流配置是否完整
2. 重新编辑并保存配置
3. 联系技术支持

## 📞 技术支持

如遇到问题，请联系：
- 技术支持邮箱：support@nndeploy.com
- 技术文档：查看 `CHANGELOG_MULTI_WORKFLOW.md`

## 📚 相关文档

- [软件操作指南](./docs/user-manual.md)
- [配置文件格式说明](./docs/config-format.md)
- [API 接口文档](./docs/api-reference.md)

---

**版本：** V1.0  
**更新时间：** 2024年  
**维护者：** NNDeploy Frontend Team
